# V8 引擎执行流程笔记（带代码示例）

---

## 1. 核心组成

1. **Parser（解析器）**  
   - 将 JS 代码解析成 **AST（抽象语法树）**  
   - 检查语法错误  

2. **Ignition（解释器）**  
   - 将 AST 转换为 **字节码（Bytecode）**  
   - 解释执行，启动快，保证冷代码可运行  

3. **TurboFan（优化编译器）**  
   - 将热点代码（运行频繁的代码）编译为 **高性能机器码**  
   - 优化手段：
     - 隐藏类（Hidden Classes）  
     - 内联缓存（Inline Caching）  
     - 类型推导与函数内联  

4. **Garbage Collector（垃圾回收器）**  
   - 自动管理堆内存  
   - 分代回收策略：
     - **New Space**：新生对象，回收快  
     - **Old Space**：长期存活对象，回收慢  

---
```
// 冷代码示例：只执行一次
function coldFunction(a, b) {
  return a + b;
}
console.log(coldFunction(1, 2)); // 3

// 热代码示例：循环执行多次
function hotFunction(n) {
  let sum = 0;
  for (let i = 0; i < n; i++) {
    sum += i;
  }
  return sum;
}

// 多次调用，触发 TurboFan 优化
for (let i = 0; i < 10000; i++) {
  hotFunction(100);
}

// 隐藏类和内联缓存
function createPerson(name, age) {
  return { name, age };
}

let p1 = createPerson("Alice", 20);
let p2 = createPerson("Bob", 25);

// TurboFan 会优化对象属性访问，利用隐藏类和内联缓存
console.log(p1.name, p2.age);

```

## 2. 执行流程可视化

```mermaid
flowchart TD
    A[JS 代码] --> B[Parser → AST]
    B --> C[Ignition → 字节码 Bytecode]
    C --> D{执行字节码}

    D -->|冷代码| E[解释执行（Ignition）]
    D -->|热代码| F[TurboFan 优化 → 机器码]
    F --> G[高性能机器码执行]

    %% 内存管理
    G --> H[堆内存 Heap]
    H --> I[垃圾回收 GC]
