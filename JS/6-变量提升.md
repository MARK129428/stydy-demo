JavaScript 执行上下文与变量提升笔记
一、执行上下文（Execution Context）

在 JavaScript 中，每段可执行代码都会创建一个 执行上下文（EC），它是一个抽象概念，用来管理代码执行的环境。

1.1 执行上下文包含

Lexical Environment（词法环境）：存储变量、函数声明等标识符绑定

Variable Environment（变量环境）：管理变量、函数声明和参数

This Binding（this绑定）

1.2 执行上下文类型

全局执行上下文（Global Execution Context）：程序入口，生命周期贯穿整个脚本

函数执行上下文（Function Execution Context）：每次函数调用创建

Eval 执行上下文（Eval Execution Context）：eval() 执行代码时创建

二、执行上下文生命周期
2.1 Creation Phase（创建阶段）

创建 Lexical Environment 和 Variable Environment

确定 this 值

函数声明提升（Function Hoisting）：函数名直接绑定到函数对象

变量声明提升（Variable Hoisting）：var 声明初始化为 undefined，let / const 处于暂时性死区（TDZ）

2.2 Execution Phase（执行阶段）

执行代码语句

对变量进行赋值

执行函数调用

三、变量提升示例
console.log(a); // 输出 undefined
console.log(f()); // 输出 5

var a = 10;

function f() {
  return 5;
}

// let / const 不会被提升到可访问状态
// console.log(b); // ReferenceError
let b = 20;

说明

var a：在 Creation Phase 被提升，初始值为 undefined

function f：在 Creation Phase 被提升，可以在声明之前调用

let b：在 Creation Phase 被注册，但进入 暂时性死区（TDZ），访问会报错

四、函数执行上下文与作用域链
var x = 1;

function outer(y) {
  var z = 3;
  function inner() {
    console.log(x + y + z);
  }
  inner();
}

outer(2); // 输出 6

分析

Global Execution Context

Lexical Environment:

x = 1

outer 函数提升

outer() Execution Context

Lexical Environment:

参数 y = 2

z = 3

inner 函数提升

outer 的 outer 指向 Global Lexical Environment

inner() Execution Context

Lexical Environment:

访问作用域链：Inner → Outer → Global

输出 x + y + z = 6

作用域链示意（文本表示）
inner Lexical Environment
       │
outer Lexical Environment
       │
Global Lexical Environment

五、总结

Hoisting（提升）：

var 声明的变量在 Creation Phase 初始化为 undefined

function 声明在 Creation Phase 可直接调用

let / const 不可提前访问，进入 TDZ

Execution Context：

每段可执行代码（全局/函数/eval）都有自己的 EC

包含 Lexical Environment、Variable Environment、this

作用域链（Scope Chain）：

Lexical Environment 通过 outer 指向父级环境

标识符解析沿作用域链向上查找